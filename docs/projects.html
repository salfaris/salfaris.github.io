<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>projects ‚Äì salman faris</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta name="twitter:title" content="projects ‚Äì salman faris">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title"><strong>salman faris</strong></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./projects.html" aria-current="page"> 
<span class="menu-text">projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./resources.html"> 
<span class="menu-text">resources</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/salfaris/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/salfaris"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
  <ul>
  <li><a href="#data-science" id="toc-data-science" class="nav-link active" data-scroll-target="#data-science"><strong>üîç data science</strong></a>
  <ul class="collapse">
  <li><a href="#financial-transactions-fraud-detection-using-machine-learning" id="toc-financial-transactions-fraud-detection-using-machine-learning" class="nav-link" data-scroll-target="#financial-transactions-fraud-detection-using-machine-learning">Financial transactions fraud detection using machine learning</a></li>
  <li><a href="#measuring-the-impact-of-a-website-redesign-the-bayesian-way" id="toc-measuring-the-impact-of-a-website-redesign-the-bayesian-way" class="nav-link" data-scroll-target="#measuring-the-impact-of-a-website-redesign-the-bayesian-way">Measuring the impact of a website redesign the Bayesian way</a></li>
  <li><a href="#regression-analysis-on-tfl-santander-cycles" id="toc-regression-analysis-on-tfl-santander-cycles" class="nav-link" data-scroll-target="#regression-analysis-on-tfl-santander-cycles">Regression analysis on TfL Santander cycles</a></li>
  </ul></li>
  <li><a href="#research-ml" id="toc-research-ml" class="nav-link" data-scroll-target="#research-ml"><strong>üî¨ research ML</strong></a>
  <ul class="collapse">
  <li><a href="#msc-thesis.-enhancing-vae-learning-on-spatial-priors-using-gcn" id="toc-msc-thesis.-enhancing-vae-learning-on-spatial-priors-using-gcn" class="nav-link" data-scroll-target="#msc-thesis.-enhancing-vae-learning-on-spatial-priors-using-gcn">MSc thesis. ‚ÄúEnhancing VAE-learning on spatial priors using GCN‚Äù</a></li>
  <li><a href="#reproduction-of-inference-suboptimality-in-variational-autoencoders-cremer-et.-al-2018-in-jax" id="toc-reproduction-of-inference-suboptimality-in-variational-autoencoders-cremer-et.-al-2018-in-jax" class="nav-link" data-scroll-target="#reproduction-of-inference-suboptimality-in-variational-autoencoders-cremer-et.-al-2018-in-jax">Reproduction of ‚Äú<em>Inference Suboptimality in Variational Autoencoders</em>‚Äù (Cremer et. al, 2018) in JAX</a></li>
  <li><a href="#reproduction-of-variational-graph-auto-encoders-kipf-and-welling-2016-in-jax" id="toc-reproduction-of-variational-graph-auto-encoders-kipf-and-welling-2016-in-jax" class="nav-link" data-scroll-target="#reproduction-of-variational-graph-auto-encoders-kipf-and-welling-2016-in-jax">Reproduction of ‚Äú<em>Variational Graph Auto-Encoders</em>‚Äù (Kipf and Welling, 2016) in JAX</a></li>
  </ul></li>
  <li><a href="#web-app" id="toc-web-app" class="nav-link" data-scroll-target="#web-app"><strong>üíª web app</strong></a>
  <ul class="collapse">
  <li><a href="#tradelogger" id="toc-tradelogger" class="nav-link" data-scroll-target="#tradelogger">TradeLogger</a></li>
  <li><a href="#allpow" id="toc-allpow" class="nav-link" data-scroll-target="#allpow">allpow</a></li>
  </ul></li>
  <li><a href="#utilities" id="toc-utilities" class="nav-link" data-scroll-target="#utilities"><strong>üîß utilities</strong></a>
  <ul class="collapse">
  <li><a href="#easyps" id="toc-easyps" class="nav-link" data-scroll-target="#easyps">EasyPS</a></li>
  <li><a href="#pyeasyps" id="toc-pyeasyps" class="nav-link" data-scroll-target="#pyeasyps">PyEasyPS</a></li>
  </ul></li>
  <li><a href="#open-source" id="toc-open-source" class="nav-link" data-scroll-target="#open-source"><strong>üì≠ open source</strong></a>
  <ul class="collapse">
  <li><a href="#jraph" id="toc-jraph" class="nav-link" data-scroll-target="#jraph">Jraph</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<div class="quarto-about-solana column-body">
  <div class="about-entity">
    <div class="entity-contents">
      <header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">projects</h1>
</div>
<div class="quarto-title-meta">
  </div>
</header> 
      <div class="about-contents"><main class="content" id="quarto-document-content">

<section id="data-science" class="level2">
<h2 data-anchor-id="data-science"><strong>üîç data science</strong></h2>
<section id="financial-transactions-fraud-detection-using-machine-learning" class="level3">
<h3 data-anchor-id="financial-transactions-fraud-detection-using-machine-learning"><a href="https://github.com/salfaris/financial-fraud-detection">Financial transactions fraud detection using machine learning</a></h3>
<p>This project covers strategy research, experimentation (with reporting) and deployment via Google Cloud.</p>
<p><img src="./assets/projects_financialFraud.png" class="img-fluid"></p>
<ul>
<li><p>Researched and verified the class weight strategy in ‚ÄúFraud Detection using Machine Learning‚Äù (Oza, 2018); and further extended the paper‚Äôs analysis with new models and metrics. I wrote a full experiment report on this strategy verification which can be found here: <a href="https://storage.cloud.google.com/financial-fraud-experiment-docs/replication_oza_2018_report.html">Replication &amp; extension of ‚ÄúFraud Detection using Machine Learning‚Äù (Oza, 2018)</a>.</p></li>
<li><p>Trained logistic regression, SVMs and decision trees to perform financial transactions fraud detection in an imbalanced dataset of 6+ million rows and 0.1% sample fraud transactions (Python, scikit-learn).</p></li>
<li><p>Built a web app to visualise streaming transactions data and perform live fraud detection using trained models. (Python, Streamlit, Docker, Google Artifact Registry, Google Cloud Run, Google Cloud Pub/Sub, Google Vertex AI).</p></li>
</ul>
<hr>
</section>
<section id="measuring-the-impact-of-a-website-redesign-the-bayesian-way" class="level3">
<h3 data-anchor-id="measuring-the-impact-of-a-website-redesign-the-bayesian-way"><a href="https://app.datacamp.com/workspace/w/cff27c6e-b68b-42df-ad82-9b0d029b7f0d">Measuring the impact of a website redesign the Bayesian way</a></h3>
<p><em>Problem statement: How can we determine if the change in observed conversion rates after website redesign is not due to random chance? Moreover, can we get an exact probability of how likely a test group is to perform better/worse than the control group?</em></p>
<p><img src="./assets/projects_bayesianAbTesting.png" class="img-fluid"></p>
<ul>
<li><p>In this mini project, I analysed the conversion rates of four different user groups (one of which is the control group) using pivot tables and bar plots to get a first big picture.</p></li>
<li><p>Then, using PyMC3, I applied Bayesian A/B testing based on a Metropolis sampler to measure which group is most likely to have a higher conversion rate than the control group. The Bayesian way yields a solid probability unlike the frequentist approach. For example, in this project, I was able to deduce that ‚Äúthere is a 99% probability that user group B has a higher conversion rate than the control group‚Äù.</p></li>
<li><p>This exact probability gives us the confidence required to make important business decisions. In this case, we can be really confident in our decision of switching to the design version exposed to group B since there is only a 1% chance of B being worse than the control. This is one of the many awesome reasons why I favor the Bayesian approach for data tasks; this also helps us answer the second problem.</p></li>
</ul>
<p><span style="font-size:0.8em"><em>This project is hosted on DataCamp Workspace.</em></span></p>
<hr>
</section>
<section id="regression-analysis-on-tfl-santander-cycles" class="level3">
<h3 data-anchor-id="regression-analysis-on-tfl-santander-cycles"><a href="https://app.datacamp.com/workspace/w/697541bd-83ce-4ee7-809c-1bc22b3f1613">Regression analysis on TfL Santander cycles</a></h3>
<p><em>Problem statement: To what extent can we use a lightweight, explainable model to predict cycle hires with lowest RMSE?</em></p>
<p>The idea of the project is to understand trends in the usage of TfL Santander Cycles (aka Boris bikes) and then predict cycle hires using linear models which are scalable and lightweight. In this project, I have</p>
<ul>
<li><p>Investigated suitability of fitting a linear model by checking existence of trends in the residuals vs fitted plot.</p></li>
<li><p>Verified normality of cycle hires after Yeo-Johnson normalisation using a density, histogram and QQ plot.</p></li>
<li><p>Applied feature engineering methods such as forward search model selection, one-hot encoding, moving average, and Yeo-Johnson normalisation.</p></li>
<li><p>Implemented a linear model with 99% lower RMSE (935.5 to 3.5) and 155% higher R 2 score (0.27 to 0.69) relative to the baseline naive linear model.</p></li>
</ul>
<p><span style="font-size:0.8em"><em>This project was hosted on Deepnote and then hosted on DataCamp Workspace.</em></span></p>
</section>
</section>
<section id="research-ml" class="level2">
<h2 data-anchor-id="research-ml"><strong>üî¨ research ML</strong></h2>
<section id="msc-thesis.-enhancing-vae-learning-on-spatial-priors-using-gcn" class="level3">
<h3 data-anchor-id="msc-thesis.-enhancing-vae-learning-on-spatial-priors-using-gcn"><a href="https://github.com/salfaris/PriorVGAE">MSc thesis. ‚ÄúEnhancing VAE-learning on spatial priors using GCN‚Äù</a></h3>
<p>My Oxford MSc thesis supervised by Seth Flaxman, Swapnil Mishra and Elizaveta Semenova.</p>
<p><img src="./assets/projects_mscThesis.png" class="img-fluid"></p>
<p>I made the observation that the PriorVAE framework in ‚Äú<em>PriorVAE: encoding spatial priors with variational autoencoders for small-area estimation</em>‚Äù (Semenova et. al, 2022) does not make efficient use of the data‚Äôs local neighbourhood structure when learning spatial priors for MCMC sampling.</p>
<p>So I proposed a new framework, called PriorVGAE, which exploits the underlying local neighbourhood structure and propagates this information efficiently via the use of graph convolutional networks (GCN). Under this new framework, we were able to perform MCMC inference with far superior performance as compared to PriorVAE while enjoying better sampling speeds. We achieved lower mean squared error (MSE) for our sample reconstructions across all our experiments and attained higher effective sample sizes with lower MCMC sampling time.</p>
<p>The breakthrough. Naively injecting a GCN into a VAE framework would not make the architecture work. The key observation was to realize that spatial priors inherently admits global information. To this end, I introduced a local-to-global scheme that consolidates all the local information into a global representation, relying on the universal approximator theorem of MLPs, to efficiently learn the spatial priors.</p>
<p>Some bonus advantages of this framework as compared to PriorVAE include getting computationally cheaper training. We now have fewer learnable parameters since we replace MLPs with GCNs and GCN weights are shared across the support. Out-of-sample predictions are also now tractable as restarting compute training is relatively inexpensive.</p>
<hr>
</section>
<section id="reproduction-of-inference-suboptimality-in-variational-autoencoders-cremer-et.-al-2018-in-jax" class="level3">
<h3 data-anchor-id="reproduction-of-inference-suboptimality-in-variational-autoencoders-cremer-et.-al-2018-in-jax"><a href="https://github.com/ATML-2022-Group6/inference-suboptimality">Reproduction of ‚Äú<em>Inference Suboptimality in Variational Autoencoders</em>‚Äù (Cremer et. al, 2018) in JAX</a></h3>
<p>We reproduced some of the key interesting experiments in the paper ‚Äú<em>Inference Suboptimality in Variational Autoencoders</em>‚Äù (Cremer et. al, 2018) using JAX and extended the result to the K-MNIST dataset. This work was done jointly with Basim Khajwal, Snehal Raj and Vasileios Ntogram.</p>
<p><img src="./assets/projects_reproductionChallenge.png" class="img-fluid"></p>
<hr>
</section>
<section id="reproduction-of-variational-graph-auto-encoders-kipf-and-welling-2016-in-jax" class="level3">
<h3 data-anchor-id="reproduction-of-variational-graph-auto-encoders-kipf-and-welling-2016-in-jax"><a href="https://github.com/salfaris/vgae-jax">Reproduction of ‚Äú<em>Variational Graph Auto-Encoders</em>‚Äù (Kipf and Welling, 2016) in JAX</a></h3>
<p>I reproduced the variational graph autoencoder (VGAE) deep learning model using JAX to be used as a component in my MSc thesis.</p>
</section>
</section>
<section id="web-app" class="level2">
<h2 data-anchor-id="web-app"><strong>üíª web app</strong></h2>
<section id="tradelogger" class="level3">
<h3 data-anchor-id="tradelogger"><a href="https://github.com/salfaris/tradelogger">TradeLogger</a></h3>
<p>This project is written in Python using the Flask framework. One of the <strong>problems with stock traders is that they do not keep the big picture of where they are in their trading journey</strong>. For example. if they are losing, do they realise that they are losing 5 trades consecutively? This tool is designed for traders to trade better. A machine learning pipeline is also added to learn the time series pattern of whether the trader has a good chance on the next trade given the outcomes of the previous trades.</p>
<p><img src="./assets/projects_tradeLogger.png" class="img-fluid"></p>
<hr>
</section>
<section id="allpow" class="level3">
<h3 data-anchor-id="allpow"><a href="https://github.com/salfaris/allpow">allpow</a></h3>
<p>This project is written in Python using Streamlit. It is a simple calculator to estimate one‚Äôs monthly budget (in London by default). I originally made it to help my fellow Malaysian students who are coming to London for the first time organise their finances better. The first problem of coming to a new country far away from home (and also most probably first time renting a property in their life) is to estimate the prices of groceries, transport, rent and the like. This calculator solves that problem.</p>
<p>Link to the deployed calculator: click <a href="https://salfaris-allpow-app-wejo3u.streamlit.app">here</a></p>
<p><br></p>
</section>
</section>
<section id="utilities" class="level2">
<h2 data-anchor-id="utilities"><strong>üîß utilities</strong></h2>
<section id="easyps" class="level3">
<h3 data-anchor-id="easyps"><a href="https://github.com/salfaris/EasyPS">EasyPS</a></h3>
<p>A simple, out of the box personal statement LaTeX framework. It helps handling duplicated tex files when writing personal statements for multiple universities, scholarships or jobs.</p>
<p><img src="./assets/projects_easyPs.png" class="img-fluid"></p>
<hr>
</section>
<section id="pyeasyps" class="level3">
<h3 data-anchor-id="pyeasyps"><a href="https://github.com/salfaris/PyEasyPS">PyEasyPS</a></h3>
<p>PyEasyPS is EasyPS (see above) ported to Python. It is even easier to use since the manual processes required in EasyPS (e.g.&nbsp;error-handling, targeted-updating of personal statements) are done for you. Essentially, it lets you focus on what‚Äôs most important ‚Äì your personal statement content.</p>
</section>
</section>
<section id="open-source" class="level2">
<h2 data-anchor-id="open-source"><strong>üì≠ open source</strong></h2>
<section id="jraph" class="level3">
<h3 data-anchor-id="jraph"><a href="https://github.com/google-deepmind/jraph">Jraph</a></h3>
<p>I am a key contributor of Jraph which is Google DeepMind‚Äôs open source library for graph neural networks using JAX.</p>


</section>
</section>
</main></div>
    </div>
  </div>
</div>
 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/salfaris\.github\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>